<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel of Names </title>
    <style>
        :root { --primary-blue: #448aff; --bg-color: #f0f2f5; }
        body { font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; background-color: var(--bg-color); margin: 0; padding: 20px; }
        
        .main-container { display: flex; gap: 40px; flex-wrap: wrap; justify-content: center; max-width: 1100px; width: 100%; margin-top: 30px; }
        .wheel-section { position: relative; }
        #canvas { background: white; border-radius: 50%; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 8px solid #fff; cursor: pointer; }
        
        #pointer { 
            position: absolute; top: 50%; right: -25px; transform: translateY(-50%);
            width: 0; height: 0; border-top: 25px solid transparent; border-bottom: 25px solid transparent; 
            border-right: 45px solid #ccc; z-index: 10; filter: drop-shadow(-2px 0 2px rgba(0,0,0,0.2));
        }

        .controls-section { width: 380px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .btn-blue { background: var(--primary-blue); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.2s; }
        .btn-blue:hover { opacity: 0.9; }
        
        #namesInput { 
            height: 350px; padding: 15px; border-radius: 10px; border: 1px solid #ddd; 
            overflow-y: auto; outline: none; background: white; font-size: 18px; 
            line-height: 1.5; white-space: pre-wrap; margin-top: 10px;
        }
        #namesInput img { width: 45px; height: 45px; border-radius: 5px; vertical-align: middle; margin: 2px; border: 1px solid #ddd; }

        /* MODAL STYLE */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; width: 450px; border-radius: 12px; overflow: hidden;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3); animation: scaleUp 0.2s ease;
        }
        @keyframes scaleUp { from {transform: scale(0.9); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        
        .modal-header { background: var(--primary-blue); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 30px 20px; text-align: center; }
        .winner-name { font-size: 42px; font-weight: bold; color: #333; margin: 10px 0; }
        .modal-footer { background: #f8f9fa; padding: 15px 20px; display: flex; justify-content: flex-end; gap: 15px; }
        
        .btn-close-flat { background: none; border: none; color: #666; cursor: pointer; font-size: 16px; font-weight: 600; }
        .btn-remove-winner { background: var(--primary-blue); color: white; border: none; padding: 10px 25px; border-radius: 6px; cursor: pointer; font-weight: 600; }

        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 12px 24px; border-radius: 8px;
            display: none; align-items: center; gap: 20px; z-index: 2000;
            font-size: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .option-item { border: 2px solid #eee; padding: 15px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; font-weight: 600; text-align: center; transition: 0.2s; }
        .option-item:hover { border-color: var(--primary-blue); background: #f0f7ff; }
        
        #fileInput { display: none; }
    </style>
</head>
<body>

    <h1 style="color: #2c3e50;">üé° Wheel of Names</h1>

    <div class="main-container">
        <div class="wheel-section">
            <div id="pointer"></div>
            <canvas id="canvas" width="500" height="500"></canvas>
        </div>
        <div class="controls-section">
            <div class="button-grid">
                <button class="btn-blue" onclick="shuffleItems()">üîÄ Shuffle</button>
                <button class="btn-blue" onclick="sortItems()">‚¨ÜÔ∏è Sort A-Z</button>
            </div>
            <button class="btn-blue" style="width:100%" onclick="openAddImage()">üñºÔ∏è Add Image</button>
            <div id="namesInput" contenteditable="true" oninput="syncFromVisual()">Budi
Siti
Andi
Dewi</div>
        </div>
    </div>

    <div id="modalTarget" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3>Select Image Purpose</h3><span onclick="closeAll()" style="cursor:pointer; font-size:24px">&times;</span></div>
            <div class="modal-body">
                <div class="option-item" onclick="chooseTarget('bg')">üü° Add Background Image</div>
                <div class="option-item" onclick="chooseTarget('center')">üéØ Add Center Image (Spinning)</div>
                <div class="option-item" onclick="chooseTarget('entry')">üçï Add Entry as Image</div>
            </div>
        </div>
    </div>
    
    <div id="modalSource" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3>Select Image Source</h3><span onclick="closeAll()" style="cursor:pointer; font-size:24px">&times;</span></div>
            <div class="modal-body">
                <div class="option-item" onclick="triggerUpload()">üì§ Upload from Device</div>
                <div class="option-item" onclick="openGallery()">üñºÔ∏è Choose from Gallery</div>
            </div>
        </div>
    </div>

    <div id="modalGallery" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3>Sample Gallery</h3><span onclick="closeAll()" style="cursor:pointer; font-size:24px">&times;</span></div>
            <div class="modal-body" id="galleryGrid" style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; max-height: 300px; overflow-y: auto;">
            </div>
            <div class="modal-footer">
                <button class="btn-close-flat" onclick="closeAll()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="winnerModal" class="modal-overlay">
        <div class="modal-content">
            <div id="modalWinnerHeader" class="modal-header">
                <h3 style="margin:0">We Have a Winner!</h3>
                <span style="cursor:pointer; font-size:24px" onclick="closeAll()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="winnerImgContainer"></div>
                <p class="winner-name" id="displayWinnerName">Winner</p>
            </div>
            <div class="modal-footer">
                <button class="btn-close-flat" onclick="closeAll()">Close</button>
                <button class="btn-remove-winner" onclick="removeWinner()">Remove Winner</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMsg">Item Removed</span>
        <span onclick="this.parentElement.style.display='none'" style="cursor:pointer; font-weight:bold; font-size:18px">‚úï</span>
    </div>

    <input type="file" id="fileInput" accept="image/*">

    <script>
        const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
        const namesInput = document.getElementById('namesInput'), fileInput = document.getElementById('fileInput');
        const colors = ['#3369e8', '#d50f25', '#eeb211', '#009925', '#f4b400', '#db4437', '#9c27b0', '#00bcd4'];
        let items = [], currentRotation = 0, isSpinning = false, lastWinnerIdx = -1, wheelBgImage = null, centerLogo = null, activeTarget = "";

        // UI & Upload Logic
        function openAddImage() { closeAll(); document.getElementById("modalTarget").style.display = "flex"; }
        function chooseTarget(t) { activeTarget = t; document.getElementById("modalTarget").style.display = "none"; document.getElementById("modalSource").style.display = "flex"; }
        function triggerUpload() { fileInput.click(); }
        
        fileInput.onchange = (e) => { 
            const file = e.target.files[0]; 
            if (file) { 
                const reader = new FileReader(); 
                reader.onload = (ev) => applyImage(ev.target.result); 
                reader.readAsDataURL(file); 
            } 
        };

        function openGallery() { 
            document.getElementById("modalSource").style.display = "none";
            const grid = document.getElementById("galleryGrid");
            const samples = ["https://picsum.photos/id/237/200", "https://picsum.photos/id/200/200", "https://picsum.photos/id/102/200"];
            grid.innerHTML = samples.map(src => `<img src="${src}" onclick="applyImage('${src}')" style="width:100%; cursor:pointer; border-radius:5px">`).join('');
            document.getElementById("modalGallery").style.display = "flex";
        }

        function applyImage(src) {
            const img = new Image();
            img.onload = () => {
                if (activeTarget === 'bg') wheelBgImage = img;
                else if (activeTarget === 'center') centerLogo = img;
                else { 
                    const newImg = document.createElement('img'); 
                    newImg.src = src; 
                    namesInput.appendChild(document.createTextNode("\n")); 
                    namesInput.appendChild(newImg); 
                }
                syncFromVisual(); closeAll();
            };
            img.src = src;
        }

        function closeAll() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = "none"); }

        // Wheel Rendering Logic
        function syncFromVisual() {
            let newItems = [];
            const temp = document.createElement('div');
            temp.innerHTML = namesInput.innerHTML.replace(/<div>/g, "\n").replace(/<\/div>/g, "").replace(/<br>/g, "\n");
            Array.from(temp.childNodes).forEach(node => {
                if (node.nodeName === "IMG") newItems.push({ name: "", image: node.cloneNode() });
                else if (node.nodeType === 3 && node.textContent.trim()) {
                    node.textContent.split('\n').forEach(line => { if(line.trim()) newItems.push({ name: line.trim(), image: null }); });
                }
            });
            items = newItems; drawWheel();
        }

        function drawWheel() {
            ctx.clearRect(0, 0, 500, 500);
            if (items.length === 0) return;
            ctx.save(); ctx.translate(250, 250); ctx.rotate(currentRotation);

            if (wheelBgImage) {
                ctx.save(); ctx.beginPath(); ctx.arc(0, 0, 240, 0, Math.PI * 2); ctx.clip();
                ctx.drawImage(wheelBgImage, -250, -250, 500, 500); ctx.restore();
            }

            const slice = (Math.PI * 2) / items.length;
            items.forEach((it, i) => {
                const angle = i * slice;
                if (!wheelBgImage) {
                    ctx.beginPath(); ctx.fillStyle = colors[i % colors.length];
                    ctx.moveTo(0, 0); ctx.arc(0, 0, 240, angle, angle + slice); ctx.fill();
                    ctx.strokeStyle = "#fff"; ctx.lineWidth = 2; ctx.stroke();
                }
                ctx.save(); ctx.rotate(angle + slice / 2);
                if (it.image) {
                    ctx.save(); ctx.beginPath(); ctx.arc(160, 0, 40, 0, Math.PI*2); ctx.clip();
                    ctx.drawImage(it.image, 120, -40, 80, 80); ctx.restore();
                } else {
                    ctx.fillStyle = "#fff"; ctx.font = "bold 24px sans-serif"; ctx.textAlign = "right";
                    ctx.fillText(it.name, 230, 8);
                }
                ctx.restore();
            });

            if (centerLogo) {
                ctx.save(); ctx.beginPath(); ctx.arc(0, 0, 60, 0, Math.PI * 2); ctx.clip();
                ctx.drawImage(centerLogo, -60, -60, 120, 120); ctx.restore();
            }
            ctx.restore();
            updatePointerColor();
        }

        function updatePointerColor() {
            if (!items.length) return;
            let norm = (0 - currentRotation) % (Math.PI * 2);
            if (norm < 0) norm += Math.PI * 2;
            const idx = Math.floor(norm / ((Math.PI * 2) / items.length));
            const color = colors[idx % colors.length];
            document.getElementById('pointer').style.borderRightColor = color;
            return color;
        }

        function spin() {
            if (isSpinning || items.length === 0) return;
            isSpinning = true;
            const extra = (Math.PI * 2) * (15 + Math.random() * 5);
            const startRot = currentRotation, startTime = performance.now();
            function anim(now) {
                const t = Math.min((now - startTime) / 4000, 1);
                const easeOut = 1 - Math.pow(1 - t, 4);
                currentRotation = startRot + (extra * easeOut);
                drawWheel();
                if (t < 1) requestAnimationFrame(anim);
                else {
                    isSpinning = false;
                    let norm = (0 - currentRotation) % (Math.PI * 2);
                    if (norm < 0) norm += Math.PI * 2;
                    lastWinnerIdx = Math.floor(norm / ((Math.PI * 2) / items.length));
                    const winner = items[lastWinnerIdx];
                    document.getElementById('displayWinnerName').innerText = winner.name || "Image Winner!";
                    document.getElementById('winnerImgContainer').innerHTML = winner.image ? `<img src="${winner.image.src}" style="width:150px; border-radius:10px; margin-bottom:15px">` : "";
                    document.getElementById('modalWinnerHeader').style.backgroundColor = updatePointerColor();
                    document.getElementById('winnerModal').style.display = "flex";
                }
            }
            requestAnimationFrame(anim);
        }

        function removeWinner() {
            if (lastWinnerIdx > -1) {
                const name = items[lastWinnerIdx].name || "Image";
                items.splice(lastWinnerIdx, 1);
                writeToInput(); closeAll(); showToast(`Removed: ${name}`);
            }
        }

        function writeToInput() {
            namesInput.innerHTML = "";
            items.forEach((it, idx) => {
                if (it.image) namesInput.appendChild(it.image.cloneNode());
                else namesInput.appendChild(document.createTextNode(it.name));
                if (idx < items.length - 1) namesInput.appendChild(document.createTextNode("\n"));
            });
            drawWheel();
        }

        function shuffleItems() { syncFromVisual(); items.sort(() => Math.random() - 0.5); writeToInput(); }
        function sortItems() { syncFromVisual(); items.sort((a, b) => (a.name || "Z").localeCompare(b.name || "Z")); writeToInput(); }
        
        function showToast(msg) { 
            const t = document.getElementById('toast'); 
            document.getElementById('toastMsg').innerText = msg; 
            t.style.display = "flex"; 
            setTimeout(() => t.style.display = "none", 3000); 
        }

        canvas.onclick = spin;
        syncFromVisual();
    </script>
</body>
</html>